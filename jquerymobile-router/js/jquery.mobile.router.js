/*!
 * jQueryMobile-router v0.9
 * http://github.com/azicchetti/jquerymobile-router
 *
 * Copyright 2011 (c) Andrea Zicchetti
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://github.com/azicchetti/jquerymobile-router/blob/master/MIT-LICENSE.txt
 * http://github.com/azicchetti/jquerymobile-router/blob/master/GPL-LICENSE.txt
 */(function(e,t){typeof define=="function"&&define.amd?define(["jquery"],t):t(jQuery)})(this,function(e){return e(document).bind("mobileinit",function(){function r(e){n&&console.log(e)}var t=e.extend({fixFirstPageDataUrl:!1,firstPageDataUrl:"index.html",ajaxApp:!1,firstMatchOnly:!1},e.mobile.jqmRouter||{}),n=!0,i=null,s=null;e(document).bind("pagebeforechange",function(t,n){var r=typeof n.toPage=="string"?n.toPage:n.toPage.jqmData("url")||"";if(n.options.hasOwnProperty("_jqmrouter_handled"))return;n.options._jqmrouter_handled=!0;var o=e.mobile.path.parseUrl(r);i=s,s=o;if(o.hash.indexOf("?")!==-1){var u=o.hash.replace(/\?.*$/,"");n.options.dataUrl=o.href,e.mobile.activePage&&u.replace(/^#/,"")==e.mobile.activePage.jqmData("url")?(n.options.allowSamePageTransition=!0,e.mobile.changePage(e(u),n.options)):e.mobile.changePage(e(u),n.options),t.preventDefault(),e.mobile.urlHistory.ignoreNextHashChange=!0}}),t.fixFirstPageDataUrl&&e(document).ready(function(){if(!window.location.pathname.match("/$"))return;var n=e(":jqmData(role='page')").first(),r=n.jqmData("url"),i=window.location.pathname+t.firstPageDataUrl+window.location.search+window.location.hash;r!=i&&n.attr("data-url",i).jqmData("url",i)}),e.mobile.Router=function(n,r,i){this.routes={pagebeforecreate:null,pagecreate:null,pagebeforeshow:null,pageshow:null,pagebeforehide:null,pagehide:null,pageinit:null,pageremove:null,pagebeforechange:null,pagebeforeload:null,pageload:null},this.evtLookup={bC:"pagebeforechange",bl:"pagebeforeload",l:"pageload",bc:"pagebeforecreate",c:"pagecreate",bs:"pagebeforeshow",s:"pageshow",bh:"pagebeforehide",h:"pagehide",i:"pageinit",rm:"pageremove"},this.routesRex={},this.conf=e.extend({},t,i||{}),this.defaultHandlerEvents={};if(this.conf.defaultHandlerEvents){var s=this.conf.defaultHandlerEvents.split(",");for(var o=0;o<s.length;o++)this.defaultHandlerEvents[this.evtLookup[s[o]]]=s[o]}this.add(n,r)},e.extend(e.mobile.Router.prototype,{documentEvts:{pagebeforechange:1,pagebeforeload:1,pageload:1},add:function(t,n,i){if(!t)return;var s=this,o=[],u=[];t instanceof Array?e.each(t,e.proxy(function(e,t){this.add(t,n,!0)},this)):e.each(t,function(e,t){if(typeof t=="string"||typeof t=="function")s.routes.pagebeforeshow===null&&(s.routes.pagebeforeshow={}),s.routes.pagebeforeshow[e]=t,s.routesRex.hasOwnProperty(e)||(s.routesRex[e]=new RegExp(e));else{var n,i=t.events.split(","),o;for(n=0;n<i.length;n++)o=s.evtLookup[i[n]],s.routes.hasOwnProperty(o)?(s.routes[o]===null&&(s.routes[o]={}),s.routes[o][e]=t.handler,s.routesRex.hasOwnProperty(e)||(s.routesRex[e]=new RegExp(e))):r("can't set unsupported route "+i[n])}});if(i===!0)return;this.userHandlers?e.extend(this.userHandlers,n||{}):this.userHandlers=n||{},e.each(s.routes,function(e,t){t!==null&&(s.documentEvts[e]?u.push(e):o.push(e))}),this._detachEvents();var a=function(e,t){s._processRoutes(e,t,this)};o.length>0&&(this._eventData={events:o.join(" "),selectors:":jqmData(role='page'),:jqmData(role='dialog')",handler:a},e(document).delegate(this._eventData.selectors,this._eventData.events,this._eventData.handler)),u.length>0&&(this._docEventData={events:u.join(" "),handler:a},e(document).bind(this._docEventData.events,this._docEventData.handler))},_processRoutes:function(t,n,o){var u=this,a,f,l,c=0;t.type in{pagebeforehide:!0,pagehide:!0,pageremove:!0}?a=i:a=s;do{if(!a)o&&(l=e(o),a=l.jqmData("url"),a&&(l.attr("id")==a&&(a="#"+a),a=e.mobile.path.parseUrl(a)));else if(!this.documentEvts[t.type]&&o&&!e(o).jqmData("url"))return;if(!a)return;f=this.conf.ajaxApp?a.pathname+a.search+a.hash:a.hash,f.length==0&&(a=""),c++}while(f.length==0&&c<=1);var h=!1;e.each(this.routes[t.type],function(e,i){var s,a;if(s=f.match(u.routesRex[e])){typeof i=="function"?a=i:typeof u.userHandlers[i]=="function"&&(a=u.userHandlers[i]);if(a)try{a.apply(u.userHandlers,[t.type,s,n,o,t]),h=!0}catch(l){r(l)}}if(h&&u.conf.firstMatchOnly)return!1});if(!h&&this.conf.defaultHandler&&this.defaultHandlerEvents[t.type]&&typeof this.conf.defaultHandler=="function")try{this.conf.defaultHandler.apply(u.userHandlers,[t.type,n,o,t])}catch(p){r(p)}},_detachEvents:function(){this._eventData&&e(document).undelegate(this._eventData.selectors,this._eventData.events,this._eventData.handler),this._docEventData&&e(document).unbind(this._docEventData.events,this._docEventData.handler)},destroy:function(){this._detachEvents(),this.routes=this.routesRex=null},getParams:function(t){if(!t)return null;var n={},r,i=t.slice(t.indexOf("?")+1).split("&");return e.each(i,function(e,t){r=t.split("="),r[0]=decodeURIComponent(r[0]),n[r[0]]?(n[r[0]]instanceof Array||(n[r[0]]=[n[r[0]]]),n[r[0]].push(decodeURIComponent(r[1]))):n[r[0]]=decodeURIComponent(r[1])}),e.isEmptyObject(n)?null:n}})}),{}});