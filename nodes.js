var Nodes=function(){var e=this,t=function(){return""+this["@label"]},n=function(e,t){var n=e["@ifIndex"],r=t["@ifIndex"];return n<r?-1:n>r?1:0},r=function(){var e="<h3>"+this.hostName+"</h3>"+"<p>"+this.ipAddress;return this.isManaged=="M"&&(e+=" (Managed)"),e+="</p>",e},i=function(){var e="<h3>",t=this["@ifIndex"];return this.ifDescr?e+=t+": "+this.ifDescr:e+=t,e+="</h3>",this.ifSpeed!=0&&this.ifSpeed!="(null)"&&(e+="<p>"+this.ifSpeed+"</p>"),e},s=function(){var e="<h3>"+this.uei.replace("uei.opennms.org/","")+"</h3>"+this.description+'<p class="ui-li-aside"><abbr class="timeago" title="'+this.time+'">'+$.timeago(this.time)+"</abbr></p>";return e};this.getTemplate=function(e){return'<h3 id="node-label">Node #'+e+"</h3>"+'<div class="opennms-node-template">'+'<div id="node-outages"></div>'+'<div id="node-ipInterfaces"></div>'+'<div id="node-snmpInterfaces"></div>'+'<div id="node-events"></div>'+"</div>"},this._updateContents=function(e,t,n){var r=$(e).find(t);r.html(n),r.find(":jqmData(role=listview)").each(function(e){$(this).hasClass("ui-listview")?(console.log("refreshing listview for "+t),$(this).listview("refresh")):(console.log("initializing listview for "+t),$(this).listview())})},this._updateNodeInfo=function(e,t){$(e).find("#node-label").html(t["@label"])},this._updateOutageInfo=function(e,t){if(t.outage.length==0)return;var n='<ul data-role="listview" data-theme="a"><li data-role="list-divider">Outages</li>';for(var r in t.outage){var i=t.outage[r];n+="<li>"+i.toListItem()+"</li>"}n+="</ul>",this._updateContents(e,"#node-outages",n)},this._updateIpInterfaceInfo=function(e,t){$.isArray(t.ipInterface)||(t.ipInterface=[t.ipInterface]);if(t.ipInterface.length==0)return;var n='<ul data-role="listview" data-theme="a"><li data-role="list-divider">IP Interfaces</li>';for(var i in t.ipInterface){var s=t.ipInterface[i];s.toListItem=r,n+="<li>"+s.toListItem()+"</li>"}n+="</ul>",this._updateContents(e,"#node-ipInterfaces",n)},this._updateSnmpInterfaceInfo=function(e,t){$.isArray(t.snmpInterface)||(t.snmpInterface=[t.snmpInterface]);if(t.snmpInterface.length==0)return;t.snmpInterface.sort(n);var r='<ul data-role="listview" data-theme="a"><li data-role="list-divider">SNMP Interfaces</li>';for(var s in t.snmpInterface){var o=t.snmpInterface[s];o.toListItem=i,r+="<li>"+o.toListItem()+"</li>"}r+="</ul>",this._updateContents(e,"#node-snmpInterfaces",r)},this._updateEventInfo=function(e,t){$.isArray(t.event)||(t.event=[t.event]);if(t["event"].length==0)return;var n='<ul data-role="listview" data-theme="a"><li data-role="list-divider">Events</li>';for(var r in t.event){var i=t.event[r];i.toListItem=s,n+="<li>"+i.toListItem()+"</li>"}n+="</ul>",this._updateContents(e,"#node-events",n)},this.updateNode=function(t,n,r){r===undefined&&(r=!0),console.log("updateNodeInfo"),$.ajax({url:getUrl("nodes/"+t),cache:r,dataType:"json"}).done(function(t){e._updateNodeInfo(n,t)}),console.log("updateOutageInfo"),$.ajax({url:getUrl("outages/forNode/"+t),data:{limit:50,orderBy:"ifLostService",order:"desc"},cache:r,dataType:"json"}).done(function(t){e._updateOutageInfo(n,outages.processOutages(t))}),console.log("updateIpInterfaceInfo"),$.ajax({url:getUrl("nodes/"+t+"/ipinterfaces"),cache:r,dataType:"json",data:"orderBy=ipHostName&orderBy=ipAddress"}).done(function(t){e._updateIpInterfaceInfo(n,t)}),console.log("updateSnmpInterfaceInfo"),$.ajax({url:getUrl("nodes/"+t+"/snmpinterfaces"),cache:r,dataType:"json",data:"orderBy=ifName&orderBy=ipAddress&orderBy=ifDesc"}).done(function(t){e._updateSnmpInterfaceInfo(n,t)}),console.log("updateEventInfo"),$.ajax({url:getUrl("events"),cache:r,dataType:"json",data:"limit=10&node.id="+t}).done(function(t){e._updateEventInfo(n,t)})},this.getNodes=function(e,n){n===undefined&&(n=!0),$.ajax({url:getUrl("nodes"),cache:n,dataType:"json",data:{limit:0,orderBy:["label","id"],order:"asc"}}).done(function(n){for(var r in n.node)n.node[r].toListItem=t;e(n)})}};